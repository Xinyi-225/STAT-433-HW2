---
title: "HW2"
author: "Xinyi Wang"
date: '2022-10-04'
output: github_document
---


```{r}
library(ggplot2)
library(dplyr)
library(nycflights13)
library(tidyverse)
flights
```

What time of day should you fly if you want to avoid delays as much as possible? Does this choice depend on anything? Season? Weather? Airport? Airline? Find three patterns (“null results” are ok!). Write your results into Rmarkdown. Include a short introduction that summarizes the three results. Then, have a section for each finding. Support each finding with data summaries and visualizations. Include your code when necessary.

#What time of day should you fly if you want to avoid delays as much as possible?
```{r}
flights %>% 
  filter(!is.na(dep_delay & arr_delay)) %>% #leave the flights that are not cancelled
  group_by(hour) %>% 
  filter(arr_delay>0) %>% 
  arrange(-arr_delay) %>%
  summarise(arr_delay = mean(arr_delay, na.rm=TRUE), 
            n = n(),) %>%
  ggplot(aes(x = hour, 
             y = arr_delay)) +    
  geom_point(color = "green") +
  ggtitle("Average Delay grouped by specific hours") + 
  labs(x="Hours in a day", y="Average Delay")
```


**The flights at 7:00 pm at night has the longest average delay, and the flights at midnight and early mornings tend to have shorter average delay. In this case, if the flights want to avoid arrival delay, it should fly at midnight and early morning.**



# Pattern 1: Airlines
```{r}
unique(flights$carrier) #check how many different types of airlines
```

```{r}
flights %>% 
  filter(!is.na(dep_delay & arr_delay)) %>% #leave the flights that are not cancelled
  group_by(hour, carrier) %>% 
#  filter(carrier == "UA") %>% 
#  arrange(-flights$arr_delay) %>%
  summarise(arr_delay = mean(arr_delay, na.rm=TRUE), 
            n = n(),) %>% #define mean arrival delay
  ggplot(aes(x = hour,
             y = arr_delay, color = carrier)) +
  ggtitle("Average Delay grouped by Airlines") + 
  labs(x="Hour", y="Mean_delay") +
  geom_point()
```

**OO, EV, YV are the top three airlines that have the longest average arrival delay than the rest of the airlines. In this case, if we want to avoid arrival delay, we should try to avoid the the airlines named OO, EV, YV.**
  
  
  
# Pattern 2: Airports
```{r}
flights %>% 
  filter(!is.na(dep_delay & arr_delay)) %>% #leave the flights that are not cancelled
  group_by(hour,origin) %>% 
  summarise(arr_delay = mean(arr_delay, na.rm=TRUE), 
            n = n(),) %>% #define mean arrival delay
  ggplot(aes(x = hour,
             y = arr_delay,
         colour = origin)) +
  ggtitle("Average Delay grouped by Airports") + 
  labs(x="Hour", y="Mean_delay") + 
  geom_point()
```

**The EWR airport has the largest average arrival delay, which is followed by LGA airport and JFK airport. In this case, if we want to avoid the arrival delay, we should try to avoid arriving at EWR airport, LGA airport and JFK airport.**



# Pattern 3: Season(Spring, summer, autumn, winter)
```{r}
#Spring = flights[month = c(1,2,3)]
#Summer = flights(month = c(4,5,6))
#Autumn = flights(month = c(7,8,9))
#Autumn = flights(month = c(10,11,12))
flights %>% 
  filter(!is.na(dep_delay & arr_delay)) %>%
  mutate(season = ifelse(month == c(1, 2, 3), "Spring", ifelse(month == c(4, 5, 6), "Summer", ifelse(month == c(7, 8, 9), "Autumn", "Winter")))) %>%
  group_by(hour, season) %>% 
  summarise(arr_delay = mean(arr_delay, na.rm=TRUE), 
            n = n(),) %>%
  ggplot(aes(x = hour, y = arr_delay,
         colour = season)) +    
  ggtitle("Average Delay grouped by specific hours")+ 
  labs(x="hours", y="Average_Delay") +
  geom_point()
```

**The flights at summer tend to have the longest average arrival delay, and the flights at autumn has the second longest average arrival delay, and the flights at winter has the third longest average arrival delay, and the flights at spring has the shortest average arrival delay. In this case, if we want to avoid arrival delay, we should try to fly at summer and avoid fly at winter.**
